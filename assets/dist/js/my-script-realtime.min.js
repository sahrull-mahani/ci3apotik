var ajax_load="<img src="+location.origin+"/assets/img/makna2-loading.gif alt='loading...' width='50' class='mx-auto d-block' />";$("#hasilCus4").html(ajax_load).load(location.href+"/cusdet"),$("#hasilPro4").html(ajax_load).load(location.href+"/prodet"),Pusher.logToConsole=!0;var pusher=new Pusher("b7a2020658dd085fd51c",{cluster:"ap1"}),channel=pusher.subscribe("ci3pusher-test");channel.bind("customer",function(s){$("#totCus").text(s.total),$("#hasilCus4").html(ajax_load).load(location.href+"/cusdet"),toastr.success(s.message),Push.create("Pesan MSM",{body:s.message,icon:location.origin+"/assets/img/makna2.png",timeout:4e3,onClick:function(){window.focus(),this.close()}})}),channel.bind("produk",function(s){$("#totPro").text(s.total),$("#hasilPro4").html(ajax_load).load(location.href+"/prodet"),toastr.success(s.message),Push.create("Pesan MSM",{body:s.message,icon:location.origin+"/assets/img/makna2.png",timeout:4e3,onClick:function(){window.focus(),this.close()}})}),channel.bind("distribusi",function(s){$("#totDis").text(s.total),toastr.success(s.message),Push.create("Pesan MSM",{body:s.message,icon:location.origin+"/assets/img/makna2.png",timeout:4e3,onClick:function(){window.focus(),this.close()}})}),channel.bind("login",function(s){$("#online-"+s.message).hasClass("bg-success")?$("#online-"+s.message).removeClass("bg-success",1e3,"easeOutBounce"):$("#online-"+s.message).addClass("bg-success",1e3,"easeOutBounce"),$("#status-"+s.message).hasClass("d-none")?$("#status-"+s.message).removeClass("d-none"):$("#status-"+s.message).addClass("d-none"),$("#totOn").text(s.total)}),channel.bind("all",function(s){toastr.info((null!=s.nama?s.nama:"Pesan ")+": "+s.message),1==s.clear&&($("#messageList").load(location.origin+"/home/chat"),$("#countPesan").text(""))});var socket=io("https://myservernode-app.herokuapp.com/",{secure:!0,transports:["websocket","polling"]});$(".modal").on("shown.bs.modal",function(){$(this).find("[autofocus]").focus()}),$("#truncteChat").on("click",function(s){s.preventDefault(),Swal.fire({title:"Anda yakin?",text:"Data akan dihapus secara permanen dari database!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yakin!"}).then(s=>{s.value&&($(this).toggleClass("d-none"),$("#btn-tr-loading").toggleClass("d-none"),$.ajax({type:"post",url:location.origin+"/home/truncateChat",data:"id=1",success:function(s){1==s?($("#messageList").load(location.origin+"/home/chat"),$("#truncteChat").toggleClass("d-none"),$("#btn-tr-loading").toggleClass("d-none"),$("#countPesan").text("")):toastr.error("gagal",s)}}))})}),$("#contactChat").on("click",function(){var s=$("#message").prop("classList");$.ajax({type:"post",url:location.origin+"/home/countlesschat",data:"id="+s[1],success:function(){$("#countPesan").text("")}}),$("#staticBackdrop").hasClass("show")&&$("#messageList").animate({scrollTop:$("#messageList").get(0).scrollHeight},1e3)}),$("#messageList").load(location.origin+"/home/chat"),socket.on("message",s=>{$("#messageList").load(location.origin+"/home/chat"),$("#message").prop("classList")[1]==s.id?$("#message").val(""):s.text&&($("#staticBackdrop").hasClass("show")||$.ajax({type:"post",url:location.origin+"/home/countchat",data:"pesan="+s.pesanBaru,success:function(s){$("#countPesan").text(s)}}),toastr.info(s.text,s.nama.split("_").join(" ")),play(),Push.create(s.nama,{body:s.text,icon:location.origin+"/assets/img/makna2.png",timeout:4e3,onClick:function(){window.focus(),this.close()}})),$("#messageList").animate({scrollTop:$("#messageList").get(0).scrollHeight},1e3)}),$("#message").on("keyup",s=>{var a=$("#message").prop("classList");13==s.which&&(socket.emit("message",{text:$("#message").val(),id:a[1],nama:a[2],pesanBaru:1}),$("#sendMessage").toggleClass("d-none"),$("#btn-sd-loading").toggleClass("d-none"),$.ajax({type:"POST",url:location.origin+"/home/sendchat",data:{pesan:$("#message").val(),id:a[1],nama:a[2]},success:function(s){1!=s?(toastr.error("Masukan pesan terlebih dahulu"),$("#message").addClass("is-invalid",300,"easeOutBounce"),$("#message").attr("placeholder","Pastikan kolom ini tidak kosong!!"),$("#sendMessage").toggleClass("d-none"),$("#btn-sd-loading").toggleClass("d-none")):($("#message").removeClass("is-invalid",300,"easeOutBounce"),$("#message").attr("placeholder","Tulis pesan..."),$("#sendMessage").toggleClass("d-none"),$("#btn-sd-loading").toggleClass("d-none"),$("#messageList").animate({scrollTop:$("#messageList").get(0).scrollHeight},1e3))},error:function(){toastr.error("gagal disimpan")}})),0!==$("#message").val()&&($("#message").removeClass("is-invalid"),$("#message").attr("placeholder","Tulis pesan..."))}),$("#sendMessage").click(()=>{var s=$("#message").prop("classList");socket.emit("message",{text:$("#message").val(),id:s[1],nama:s[2],pesanBaru:1}),$("#sendMessage").toggleClass("d-none"),$("#btn-sd-loading").toggleClass("d-none"),$.ajax({type:"POST",url:location.origin+"/home/sendchat",data:{pesan:$("#message").val(),id:s[1],nama:s[2]},success:function(s){1!=s?(toastr.error("gagal disimpan"),$("#message").addClass("is-invalid",300,"easeOutBounce"),$("#message").attr("placeholder","Pastikan kolom ini tidak kosong!!"),$("#sendMessage").toggleClass("d-none"),$("#btn-sd-loading").toggleClass("d-none")):($("#sendMessage").toggleClass("d-none"),$("#btn-sd-loading").toggleClass("d-none"),$("#messageList").animate({scrollTop:$("#messageList").get(0).scrollHeight},1e3))},error:function(){toastr.error("gagal disimpan")}})});